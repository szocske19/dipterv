<html>
<head>
	<title>mxGraph Workflow Example</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css" media="screen">
		div.base {
			position: absolute;
			overflow: hidden;
			font-family: Arial;
			font-size: 8pt;
		}
		div.base#graph {
			border-style: solid;
			border-color: #F2F2F2;
			border-width: 1px;
			background: url('images/grid.gif');
		}
	</style>
	<script type="text/javascript">
		mxBasePath = '../javascript/src';
	</script>
	<style>
		pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }
			.string { color: green; }
			.number { color: darkorange; }
			.boolean { color: blue; }
			.null { color: magenta; }
			.key { color: red; }
	</style>
	<script type="text/javascript" src="../javascript/src/js/mxClient.js"></script>
	<script type="text/javascript" src="config/app.js"></script>
	<script type="text/javascript" src="vwql/mxVWQLToolbar.js"></script>
	<script type="text/javascript" src="vwql/mxVWQLToolbarCodec.js"></script>
	<script type="text/javascript" src="vwql/cumstomCells/unresizableCell.js"></script>
	<script type="text/javascript">
		mxGraph.prototype.htmlLabels = true;
	
		mxGraph.prototype.isWrapping = function(cell)
		{
			return true;
		};
		
		mxConstants.DEFAULT_HOTSPOT = 1;
		
		// Enables guides
		mxGraphHandler.prototype.guidesEnabled = true;
		
	    // Alt disables guides
	    mxGuide.prototype.isEnabledForEvent = function(evt)
	    {
	    	return !mxEvent.isAltDown(evt);
	    };
		
		// Enables snapping waypoints to terminals
		mxEdgeHandler.prototype.snapToTerminals = true;
		
		window.onbeforeunload = function() { return mxResources.get('changesLost'); };
	</script>
	<script type="text/javascript">
		/**
		* Redirects start drag to parent.
		*/
		var graphHandlerGetInitialCellForEvent = mxGraphHandler.prototype.getInitialCellForEvent;
		mxGraphHandler.prototype.getInitialCellForEvent = function(me)
		{
			var cell = graphHandlerGetInitialCellForEvent.apply(this, arguments);

					
			if (this.graph.isPart(cell))
			{
				cell = this.graph.getModel().getParent(cell);
			}
			
			return cell;
		};

		// Program starts here. Creates a sample graph in the
		// DOM node with the specified ID. This function is invoked
		// from the onLoad event handler of the document (see below).
		function main(container)
		{
			if (!mxClient.isBrowserSupported())
			{
				// Displays an error message if the browser is not supported.
				mxUtils.error('Browser is not supported!', 200, false);
			}
			else
			{
				var editor = createEditor('config/workfloweditor.xml');
				var graph = editor.graph

				graph.isPart = function(cell)
				{
					var state = this.view.getState(cell);
					var style = (state != null) ? state.style : this.getCellStyle(cell);

					return style['constituent'] == '1';
				};

				var button = mxUtils.button('View XML', function()
				{
					var encoder = new mxCodec();
					var node = encoder.encode(graph.getModel());
					xml = mxUtils.getPrettyXml(node);
					output = `<pre>${syntaxHighlight(xml)}</pre>`
					document.getElementById('to').innerHTML = output;
				});
				
				var to = document.getElementById('xmlViewer');
				to.insertBefore(button, document.getElementById('to'));
			}
		};
	</script>
	<script>
		function syntaxHighlight(json) {
			json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
			return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
				var cls = 'number';
				if (/^"/.test(match)) {
					if (/:$/.test(match)) {
						cls = 'key';
					} else {
						cls = 'string';
					}
				} else if (/true|false/.test(match)) {
					cls = 'boolean';
				} else if (/null/.test(match)) {
					cls = 'null';
				}
				return '<span class="' + cls + '">' + match + '</span>';
			});
		}
	  </script>
</head>
<!-- <body onload="createEditor('config/workfloweditor.xml');"> -->
<body onload="main(document.getElementById('graph'));" style="display: flex;">
	<table id="splash" width="100%" height="100%"
		style="background:white;position:absolute;top:0px;left:0px;z-index:4;">
		<tr>
			<td align="center" valign="middle">
				<img src="images/loading.gif">
			</td>
		</tr>
	</table>		
	<div id="status" class="base" align="right" style="white-space:nowrap;">
		<!-- Status Here -->
	</div>
	<div id="graph" style="float: left; position:relative;overflow:hidden;width:1200px;height:800px;background:url('images/grid.gif');cursor:default;">
		<!-- Graph Here -->
	</div>
	<div id="xmlViewer" style="float: left;margin-left: 100;" >
		<div id="to"; contenteditable="true";></div>
	</div>
</body>
</html>
